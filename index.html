<!DOCTYPE html>
<html lang="zh-Hant">
<head>
<meta charset="utf-8">
<meta name="viewport" content="width=device-width, initial-scale=1, viewport-fit=cover, user-scalable=no">
<title>ã‚¬ãƒ©ã‚¬ãƒ©ç¦å¼•ãï½œiPad è½‰æŠŠæ‰‹åŒæ­¥ç‰ˆï¼ˆé˜²æ»‘å‹•ï¼‰</title>
<meta name="apple-mobile-web-app-capable" content="yes">
<meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
<style>
  :root{
    --bg:#f6f7fb; --ink:#101418; --sub:#66707a; --card:#fff;
    --shadow:0 10px 30px rgba(0,0,0,.10); --radius:22px;
  }
  *{box-sizing:border-box;-webkit-tap-highlight-color:transparent}
  html,body{height:100%}
  body{margin:0;font-family:ui-sans-serif,system-ui,-apple-system,"Noto Sans TC",Segoe UI,Roboto;background:radial-gradient(1200px 800px at 70% -10%,#fff,var(--bg));color:var(--ink);overscroll-behavior:none}
  body.lock{overflow:hidden;position:relative}
  .wrap{max-width:1200px;margin:0 auto;padding:22px;padding-bottom:max(22px,env(safe-area-inset-bottom))}
  header{margin-bottom:12px}
  h1{font-size:clamp(18px,2.6vw,28px);margin:0}
  .sub{color:var(--sub);margin:2px 0 0;font-size:14px}
  main{display:grid;grid-template-columns:1.1fr .9fr;gap:20px}
  @media (max-width:1024px){main{grid-template-columns:1fr}}
  .card{background:var(--card);border-radius:var(--radius);box-shadow:var(--shadow);padding:18px}
  .stage{display:grid;grid-template-rows:auto 1fr auto;gap:16px;min-height:520px}
  .machine{position:relative;height:min(56vh,560px);display:grid;place-items:center;overflow:hidden;touch-action:none}
  .drum{width:min(520px,92%);aspect-ratio:1/1}
  .hex{transform-origin:50% 50%}
  .crank{transform-origin:165px 99px} /* ä»¥æŠŠæ‰‹ä¸­å¿ƒç‚ºåŸºæº– */
  /* æŠ½çæ™‚è®“è½‰ç›¤ + æŠŠæ‰‹ä¸€èµ·æ—‹è½‰ */
  .spin .hex, .spin .crank{animation:roll 1.4s cubic-bezier(.2,.7,.2,1) forwards}
  @keyframes roll{0%{transform:rotate(0)}100%{transform:rotate(720deg)}}
  .ball-slot{position:absolute;bottom:34px;left:50%;transform:translateX(-50%);display:flex;align-items:center;gap:12px}
  .ball{width:72px;height:72px;border-radius:50%;border:3px solid #1112;background:#e5e7eb;
        box-shadow:inset 0 8px 12px rgba(255,255,255,.7), inset 0 -10px 14px rgba(0,0,0,.15), 0 10px 16px rgba(0,0,0,.08);
        display:grid;place-items:center;font-weight:800;color:#111c;transform:translateY(90px);opacity:0}
  .ball.show{animation:pop .5s ease-out forwards}
  @keyframes pop{0%{transform:translateY(90px) scale(.9);opacity:0}60%{transform:translateY(-6px) scale(1.04);opacity:1}100%{transform:translateY(0) scale(1);opacity:1}}
  .label{font-size:22px;font-weight:800;letter-spacing:.08em;padding:10px 16px;border-radius:14px;background:#111;color:#fff;box-shadow:0 8px 18px rgba(0,0,0,.18);min-width:112px;text-align:center}
  .controls{display:flex;flex-wrap:wrap;gap:12px;align-items:center;justify-content:center}
  button{appearance:none;border:0;cursor:pointer;padding:16px 22px;border-radius:16px;font-weight:800;background:#111;color:#fff;min-height:56px;font-size:18px}
  .btn-ghost{background:#e5e7eb;color:#111}
  .odds{display:grid;grid-template-columns:repeat(4,1fr);gap:12px;margin-top:10px}
  .odds .row{display:flex;align-items:center;gap:10px;background:#f3f4f6;border-radius:14px;padding:12px 14px;font-size:18px}
  .chip{width:22px;height:22px;border-radius:50%;border:2px solid #1113;box-shadow:inset 0 3px 5px rgba(255,255,255,.7), inset 0 -3px 5px rgba(0,0,0,.2);flex:0 0 22px}
  .chip.white{background:#fafafa}.chip.blue{background:#3b82f6}.chip.red{background:#ef4444}.chip.yellow{background:#fbbf24}
  input[type="number"]{width:100%;padding:12px;border:1px solid #e5e7eb;border-radius:12px;background:#fff;font-size:18px}
  #crankHit{cursor:grab;touch-action:none}
  .grabbing #crankHit{cursor:grabbing}
  .stats{display:grid;gap:12px}
  .statgrid{display:grid;grid-template-columns:repeat(4,1fr);gap:12px}
  .pill{display:grid;gap:8px;justify-items:center;padding:14px;border-radius:16px;background:#f3f4f6}
  .pill .count{font-size:28px;font-weight:900}
  #confetti{position:fixed;inset:0;pointer-events:none}
</style>
</head>
<body>
<canvas id="confetti"></canvas>
<div class="wrap">
  <header>
    <h1>ã‚¬ãƒ©ã‚¬ãƒ©ç¦å¼•ãï½œiPad è½‰æŠŠæ‰‹åŒæ­¥ç‰ˆ</h1>
    <p class="sub">æŠ“ä½æŠŠæ‰‹è½‰å‹•ï¼Œè½‰æ»¿ä¸€åœˆè‡ªå‹•æŠ½çã€‚æ‹–æ›³ä¸­æŠŠæ‰‹èˆ‡è½‰ç›¤**åŒæ­¥æ—‹è½‰**ã€‚</p>
  </header>

  <main>
    <section class="card stage">
      <div class="machine" id="machine">
        <svg class="drum" viewBox="0 0 200 200" aria-label="ç¦å¼•ãæ©Ÿ">
          <defs>
            <linearGradient id="g1" x1="0" x2="0" y1="0" y2="1">
              <stop offset="0" stop-color="#f59e0b"/><stop offset="1" stop-color="#b45309"/>
            </linearGradient>
            <linearGradient id="wood" x1="0" x2="0" y1="0" y2="1">
              <stop offset="0" stop-color="#d6b28a"/><stop offset="1" stop-color="#a8825a"/>
            </linearGradient>
          </defs>
          <rect x="20" y="160" width="160" height="18" rx="6" fill="url(#wood)"/>
          <rect x="50" y="150" width="100" height="10" rx="4" fill="url(#wood)"/>
          <g class="hex" id="hex">
            <polygon points="100,35 145,55 165,100 145,145 100,165 55,145 35,100 55,55" fill="url(#g1)" stroke="#8b5a11" stroke-width="2"/>
            <polygon points="100,60 130,73 140,100 130,127 100,140 70,127 60,100 70,73" fill="#fde68a" opacity=".9" stroke="#b45309" stroke-width="1.5"/>
            <circle cx="100" cy="100" r="7" fill="#1f2937"/>
          </g>
          <g class="crank" id="crank">
            <rect x="122" y="96" width="38" height="6" rx="3" fill="#374151"/>
            <circle id="knob" cx="165" cy="99" r="7" fill="#111"/>
            <circle cx="165" cy="99" r="4" fill="#e5e7eb"/>
            <circle id="crankHit" cx="165" cy="99" r="18" fill="transparent"/>
          </g>
          <rect x="92" y="138" width="16" height="22" rx="3" fill="#111"/>
          <rect x="84" y="156" width="32" height="8" rx="3" fill="#111"/>
        </svg>

        <div class="ball-slot" aria-live="polite">
          <div class="ball" id="ball"><span id="ballText">ï¼Ÿ</span></div>
          <div class="label" id="label">æŠ“ä½æŠŠæ‰‹è½‰å‹•</div>
        </div>
      </div>

      <div class="controls">
        <button id="rollBtn">ğŸ² é»ä¸€ä¸‹æŠ½</button>
        <button class="btn-ghost" id="copyBtn">è¤‡è£½çµæœ</button>
        <button class="" id="resetBtn">é‡ç½®</button>
      </div>

      <div class="odds">
        <div class="row"><span class="chip white"></span><label>ç™½ <input type="number" id="odds-white" min="0" step="1" value="60"></label></div>
        <div class="row"><span class="chip blue"></span><label>è— <input type="number" id="odds-blue"  min="0" step="1" value="20"></label></div>
        <div class="row"><span class="chip red"></span><label>ç´… <input type="number" id="odds-red"   min="0" step="1" value="15"></label></div>
        <div class="row"><span class="chip yellow"></span><label>é»ƒ <input type="number" id="odds-yellow"min="0" step="1" value="5"></label></div>
      </div>
    </section>

    <aside class="card">
      <div class="stats">
        <div class="statgrid">
          <div class="pill"><div class="chip white"></div><div>ç™½</div><div class="count" id="c-white">0</div></div>
          <div class="pill"><div class="chip blue"></div><div>è—</div><div class="count" id="c-blue">0</div></div>
          <div class="pill"><div class="chip red"></div><div>ç´…</div><div class="count" id="c-red">0</div></div>
          <div class="pill"><div class="chip yellow"></div><div>é»ƒ</div><div class="count" id="c-yellow">0</div></div>
        </div>
        <div class="history" id="history" style="max-height:40vh;overflow:auto;border:1px dashed #e5e7eb;border-radius:14px;padding:10px;background:#fff"></div>
      </div>
    </aside>
  </main>
</div>

<script>
(function(){
  const machine = document.getElementById('machine');
  const hex = document.getElementById('hex');
  const crank = document.getElementById('crank');
  const crankHit = document.getElementById('crankHit');
  const rollBtn = document.getElementById('rollBtn');
  const copyBtn = document.getElementById('copyBtn');
  const resetBtn = document.getElementById('resetBtn');
  const ballEl = document.getElementById('ball');
  const ballText = document.getElementById('ballText');
  const labelEl = document.getElementById('label');
  const histEl = document.getElementById('history');

  const oddsInputs = {
    white: document.getElementById('odds-white'),
    blue:  document.getElementById('odds-blue'),
    red:   document.getElementById('odds-red'),
    yellow:document.getElementById('odds-yellow')
  };
  const counters = {
    white: document.getElementById('c-white'),
    blue:  document.getElementById('c-blue'),
    red:   document.getElementById('c-red'),
    yellow:document.getElementById('c-yellow')
  };

  const COLORS = {
    white:{ zh:'ç™½', ja:'ç™½', css:'#fafafa', text:'#111' },
    blue: { zh:'è—', ja:'é’', css:'#3b82f6', text:'#fff' },
    red:  { zh:'ç´…', ja:'èµ¤', css:'#ef4444', text:'#fff' },
    yellow:{ zh:'é»ƒ', ja:'é»„', css:'#fbbf24', text:'#111' }
  };

  let counts = {white:0, blue:0, red:0, yellow:0};
  let spinning = false;
  let lastResult = null;

  // ----- æ©Ÿç‡ -----
  function readWeights(){
    const w = {
      white: Math.max(0, parseInt(oddsInputs.white.value||'0',10)),
      blue:  Math.max(0, parseInt(oddsInputs.blue.value ||'0',10)),
      red:   Math.max(0, parseInt(oddsInputs.red.value  ||'0',10)),
      yellow:Math.max(0, parseInt(oddsInputs.yellow.value||'0',10)),
    };
    const t = w.white + w.blue + w.red + w.yellow;
    if(t<=0){ w.white=60; w.blue=20; w.red=15; w.yellow=5; }
    return w;
  }
  function pick(){
    const w = readWeights();
    let t = w.white + w.blue + w.red + w.yellow;
    let r = Math.random()*t;
    if((r -= w.white) < 0) return 'white';
    if((r -= w.blue)  < 0) return 'blue';
    if((r -= w.red)   < 0) return 'red';
    return 'yellow';
  }

  // ----- é¡¯ç¤ºçµæœ -----
  function showBall(colorKey){
    const c = COLORS[colorKey];
    ballEl.style.background = c.css;
    ballEl.style.color = c.text;
    ballText.textContent = c.zh;
    ballEl.classList.remove('show'); // reset
    // next frame to retrigger animation
    requestAnimationFrame(()=> ballEl.classList.add('show'));
    labelEl.textContent = `ä¸­çï¼š${c.zh}ï¼ˆ${c.ja}ï¼‰`;
  }
  function addHistory(colorKey){
    const d = new Date(); const pad=n=>String(n).padStart(2,'0');
    const time = `${pad(d.getHours())}:${pad(d.getMinutes())}:${pad(d.getSeconds())}`;
    const c = COLORS[colorKey];
    const row = document.createElement('div');
    row.style.display='flex'; row.style.alignItems='center'; row.style.gap='10px';
    row.style.padding='8px 6px'; row.style.borderBottom='1px solid #f3f4f6';
    const dot = document.createElement('span'); dot.style.width='16px'; dot.style.height='16px'; dot.style.borderRadius='50%'; dot.style.background=c.css; dot.style.border='2px solid #0002';
    const name = document.createElement('b'); name.textContent=c.zh;
    const t = document.createElement('span'); t.style.marginLeft='auto'; t.style.color='#9ca3af'; t.style.fontSize='12px'; t.textContent=time;
    row.append(dot,name,t); histEl.prepend(row);
  }
  function updateCounts(){
    counters.white.textContent = counts.white;
    counters.blue.textContent  = counts.blue;
    counters.red.textContent   = counts.red;
    counters.yellow.textContent= counts.yellow;
  }

  // ----- æŠ½çæµç¨‹ -----
  function spinAndDraw(){
    if(spinning) return;
    spinning = true;
    labelEl.textContent = 'æŠ½é¸ä¸­â€¦';
    machine.classList.add('spin');                 // è®“ hex + crank ä¸€èµ·æ—‹è½‰
    setTimeout(()=>{
      machine.classList.remove('spin');
      const color = pick();
      lastResult = color;
      counts[color]++; updateCounts();
      addHistory(color);
      showBall(color);
      spinning = false;
    }, 1400); // èˆ‡ @keyframes roll æ™‚é–“ä¸€è‡´
  }

  // ----- æŠŠæ‰‹æ‹–æ›³ï¼ˆåŒæ­¥æ—‹è½‰ï¼‰+ é˜²æ»‘å‹• -----
  let dragging=false, lastAngle=0, accumDeg=0;
  const TRIGGER_DEG = 360;

  function getCenter(el){ const r=el.getBoundingClientRect(); return {x:r.left+r.width/2, y:r.top+r.height/2}; }
  function angleFrom(c, x,y){ return Math.atan2(y-c.y, x-c.x); }
  function rad2deg(r){ return r*180/Math.PI; }
  function normDeg(d){ while(d>180)d-=360; while(d<-180)d+=360; return d; }

  function startDrag(x,y){
    if(spinning) return;
    dragging = true; accumDeg = 0;
    const c = getCenter(crankHit);
    crank.dataset.cx = c.x; crank.dataset.cy = c.y;
    lastAngle = angleFrom(c, x, y);
    document.body.classList.add('lock');
    crank.classList.add('grabbing');
  }
  function moveDrag(x,y, prevent){
    if(!dragging) return;
    const cx = parseFloat(crank.dataset.cx), cy = parseFloat(crank.dataset.cy);
    const ang = angleFrom({x:cx,y:cy}, x, y);
    let delta = rad2deg(ang - lastAngle); delta = normDeg(delta);
    lastAngle = ang;
    accumDeg += delta;

    // åŒæ­¥æ—‹è½‰ï¼ˆæ‹–æ›³æ™‚ hex èˆ‡ crank è§’åº¦ä¸€è‡´ï¼‰
    const rot = accumDeg % 360;
    hex.style.transform = `rotate(${rot}deg)`;
    crank.style.transform = `rotate(${rot}deg)`;

    labelEl.textContent = `è½‰å‹•ä¸­â€¦ ${Math.floor(Math.abs(accumDeg))}Â°`;
    if(prevent) prevent();

    if(Math.abs(accumDeg) >= TRIGGER_DEG){
      endDrag();
      // å°å»¶é²éŠœæ¥å‹•ç•«ï¼Œå†æ­£å¼æŠ½
      setTimeout(spinAndDraw, 150);
    }
  }
  function endDrag(){
    if(!dragging) return;
    dragging = false;
    document.body.classList.remove('lock');
    crank.classList.remove('grabbing');
    // æ­¸é›¶æš«å­˜æ—‹è½‰ï¼ˆç”±å‹•ç•«æ¥æ‰‹ï¼‰
    hex.style.transform = `rotate(0deg)`;
    crank.style.transform = `rotate(0deg)`;
    if(Math.abs(accumDeg) < TRIGGER_DEG){
      labelEl.textContent = 'å†å¤šè½‰ä¸€é»ï¼';
      setTimeout(()=>{ if(!spinning) labelEl.textContent='æŠ“ä½æŠŠæ‰‹è½‰å‹•'; }, 900);
    }
  }

  // Pointer / Touch ç¶å®šï¼ˆéè¢«å‹• + preventDefaultï¼‰
  if(window.PointerEvent){
    crankHit.addEventListener('pointerdown', e=>{ e.preventDefault(); startDrag(e.clientX, e.clientY); crankHit.setPointerCapture?.(e.pointerId); }, {passive:false});
    window.addEventListener('pointermove', e=>{ if(!dragging) return; e.preventDefault(); moveDrag(e.clientX, e.clientY, ()=>e.preventDefault()); }, {passive:false});
    window.addEventListener('pointerup', e=>{ if(dragging){ e.preventDefault(); endDrag(); } }, {passive:false});
    window.addEventListener('pointercancel', e=>{ if(dragging){ e.preventDefault(); endDrag(); } }, {passive:false});
  }else{
    crankHit.addEventListener('touchstart', e=>{ e.preventDefault(); const t=e.touches[0]; startDrag(t.clientX, t.clientY); }, {passive:false});
    window.addEventListener('touchmove', e=>{ if(!dragging) return; e.preventDefault(); const t=e.touches[0]; moveDrag(t.clientX, t.clientY, ()=>e.preventDefault()); }, {passive:false});
    window.addEventListener('touchend', e=>{ if(dragging){ e.preventDefault(); endDrag(); } }, {passive:false});
    crankHit.addEventListener('mousedown', e=>{ e.preventDefault(); startDrag(e.clientX, e.clientY); });
    window.addEventListener('mousemove', e=>{ if(!dragging) return; e.preventDefault(); moveDrag(e.clientX, e.clientY, ()=>e.preventDefault()); });
    window.addEventListener('mouseup', e=>{ if(dragging){ e.preventDefault(); endDrag(); } });
  }

  // é˜»æ“‹ç¸®æ”¾æ‰‹å‹¢
  window.addEventListener('gesturestart', e=>e.preventDefault(), {passive:false});

  // å‚™ç”¨æ“ä½œ
  rollBtn.addEventListener('click', ()=>{ if(!spinning) spinAndDraw(); });
  machine.addEventListener('click', (e)=>{ if(e.target.id==='crankHit' || e.target.id==='knob') return; if(!spinning) spinAndDraw(); });
  copyBtn.addEventListener('click', ()=>{
    const w=readWeights(); const text = lastResult ? `ç¦å¼•çµæœï¼š${COLORS[lastResult].zh}ï¼ˆ${COLORS[lastResult].ja}ï¼‰ï½œæ©Ÿç‡æ¬Šé‡ ç™½/è—/ç´…/é»ƒï¼š${w.white}/${w.blue}/${w.red}/${w.yellow}`
                                                   : `å°šæœªæŠ½é¸ã€‚æ©Ÿç‡æ¬Šé‡ ç™½/è—/ç´…/é»ƒï¼š${w.white}/${w.blue}/${w.red}/${w.yellow}`;
    navigator.clipboard.writeText(text).then(()=>{ labelEl.textContent='å·²è¤‡è£½çµæœ'; setTimeout(()=>{ labelEl.textContent = lastResult?`ä¸­çï¼š${COLORS[lastResult].zh}ï¼ˆ${COLORS[lastResult].ja}ï¼‰`:'æŠ“ä½æŠŠæ‰‹è½‰å‹•'; }, 900); });
  });
  resetBtn.addEventListener('click', ()=>{
    counts = {white:0, blue:0, red:0, yellow:0}; updateCounts();
    histEl.innerHTML=''; lastResult=null; ballText.textContent='ï¼Ÿ'; ballEl.classList.remove('show');
    ballEl.style.background='#e5e7eb'; ballEl.style.color='#111c'; labelEl.textContent='å·²é‡ç½®';
    setTimeout(()=>labelEl.textContent='æŠ“ä½æŠŠæ‰‹è½‰å‹•', 900);
  });

  // æ¬Šé‡è¼¸å…¥ä¿®æ­£ç‚ºæ•´æ•¸ä¸”éè² 
  Object.values(oddsInputs).forEach(inp=>{
    inp.addEventListener('input', ()=>{ if(inp.value==='') return; const v=Math.max(0, Math.round(Number(inp.value)||0)); inp.value=String(v); });
  });
})();
</script>
</body>
</html>
