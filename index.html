<!DOCTYPE html>
<html lang="zh-Hant">
<head>
<meta charset="utf-8">
<meta name="viewport" content="width=device-width, initial-scale=1, viewport-fit=cover, user-scalable=no">
<title>ã‚¬ãƒ©ã‚¬ãƒ©ç¦å¼•ãï½œä¸­å¿ƒæŠŠæ‰‹ç‰ˆ</title>
<meta name="apple-mobile-web-app-capable" content="yes">
<style>
  body{margin:0;background:#f7f8fa;font-family:sans-serif;display:flex;justify-content:center;align-items:center;height:100vh;overflow:hidden;-webkit-user-select:none;user-select:none;}
  .machine{position:relative;touch-action:none;}
  svg{width:300px;height:300px;}
  .hex,.crank{transform-origin:100px 100px;transition:transform .3s ease-out;}
  .spin .hex,.spin .crank{animation:roll 1.4s cubic-bezier(.2,.7,.2,1) forwards;}
  @keyframes roll{0%{transform:rotate(0)}100%{transform:rotate(720deg)}}
  #crankHit{cursor:grab;touch-action:none;}
  .grabbing #crankHit{cursor:grabbing;}
  .label{position:absolute;width:100%;text-align:center;bottom:-50px;font-weight:700;font-size:18px;}
</style>
</head>
<body>
<div class="machine" id="machine">
  <svg viewBox="0 0 200 200">
    <!-- å…­è§’è¼ªç›¤ -->
    <g class="hex" id="hex">
      <polygon points="100,30 160,60 160,140 100,170 40,140 40,60" fill="#f9cc4a" stroke="#b58800" stroke-width="3"/>
      <circle cx="100" cy="100" r="7" fill="#222"/>
    </g>
    <!-- æŠŠæ‰‹ï¼ˆä¸­å¿ƒè»¸ï¼‰ -->
    <g class="crank" id="crank">
      <circle cx="100" cy="100" r="9" fill="#444"/>
      <line x1="100" y1="100" x2="100" y2="65" stroke="#222" stroke-width="5" stroke-linecap="round"/>
      <circle id="knob" cx="100" cy="65" r="8" fill="#111"/>
      <circle id="crankHit" cx="100" cy="65" r="18" fill="transparent"/>
    </g>
  </svg>
  <div class="label" id="label">æŠ“ä½æŠŠæ‰‹è½‰å‹•</div>
</div>

<script>
(function(){
  const machine=document.getElementById('machine');
  const hex=document.getElementById('hex');
  const crank=document.getElementById('crank');
  const crankHit=document.getElementById('crankHit');
  const label=document.getElementById('label');
  let dragging=false,lastAngle=0,accumDeg=0;
  const TRIGGER=360;

  function getCenter(){return {x:machine.getBoundingClientRect().left+150,y:machine.getBoundingClientRect().top+150};}
  function angle(c,x,y){return Math.atan2(y-c.y,x-c.x);}
  function deg(r){return r*180/Math.PI;}
  function norm(d){while(d>180)d-=360;while(d<-180)d+=360;return d;}

  function start(x,y){
    dragging=true;accumDeg=0;
    const c=getCenter();crank.dataset.cx=c.x;crank.dataset.cy=c.y;
    lastAngle=angle(c,x,y);crank.classList.add('grabbing');document.body.classList.add('lock');
  }
  function move(x,y){
    if(!dragging)return;
    const cx=parseFloat(crank.dataset.cx),cy=parseFloat(crank.dataset.cy);
    let d=deg(angle({x:cx,y:cy},x,y)-lastAngle);d=norm(d);lastAngle=angle({x:cx,y:cy},x,y);accumDeg+=d;
    const rot=accumDeg%360;
    hex.style.transform=`rotate(${rot}deg)`;crank.style.transform=`rotate(${rot}deg)`;
    label.textContent=`è½‰å‹•ä¸­ ${Math.floor(Math.abs(accumDeg))}Â°`;
    if(Math.abs(accumDeg)>=TRIGGER){end();spin();}
  }
  function end(){if(!dragging)return;dragging=false;crank.classList.remove('grabbing');document.body.classList.remove('lock');}
  function spin(){
    machine.classList.add('spin');label.textContent='æŠ½é¸ä¸­â€¦';
    setTimeout(()=>{machine.classList.remove('spin');label.textContent='ğŸ‰ä¸­çï¼';},1400);
  }

  // Touch + Mouse æ”¯æ´
  crankHit.addEventListener('touchstart',e=>{e.preventDefault();const t=e.touches[0];start(t.clientX,t.clientY);},{passive:false});
  window.addEventListener('touchmove',e=>{if(!dragging)return;e.preventDefault();const t=e.touches[0];move(t.clientX,t.clientY);},{passive:false});
  window.addEventListener('touchend',e=>{if(dragging){e.preventDefault();end();}},{passive:false});
  crankHit.addEventListener('mousedown',e=>{e.preventDefault();start(e.clientX,e.clientY);});
  window.addEventListener('mousemove',e=>{if(!dragging)return;e.preventDefault();move(e.clientX,e.clientY);});
  window.addEventListener('mouseup',e=>{if(dragging){e.preventDefault();end();}});
})();
</script>
</body>
</html>
