<!DOCTYPE html>
<html lang="zh-Hant">
<head>
<meta charset="utf-8">
<meta name="viewport" content="width=device-width, initial-scale=1, viewport-fit=cover, user-scalable=no">
<title>ã‚¬ãƒ©ã‚¬ãƒ©ç¦å¼•ãï½œiPad ä¸­å¿ƒæŠŠæ‰‹ å…¨åŠŸèƒ½ç‰ˆ</title>
<meta name="apple-mobile-web-app-capable" content="yes">
<meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
<style>
  :root{
    --bg:#f6f7fb; --ink:#101418; --sub:#66707a; --card:#fff;
    --shadow:0 10px 30px rgba(0,0,0,.10); --radius:22px;
  }
  *{box-sizing:border-box;-webkit-tap-highlight-color:transparent}
  html,body{height:100%}
  body{
    margin:0;font-family:ui-sans-serif,system-ui,-apple-system,"Noto Sans TC",Segoe UI,Roboto;
    background:radial-gradient(1200px 800px at 70% -10%, #fff, var(--bg));
    color:var(--ink); overscroll-behavior:none;
  }
  body.lock{overflow:hidden;position:relative}
  .wrap{max-width:1280px;margin:0 auto;padding:22px;padding-bottom:max(22px,env(safe-area-inset-bottom))}
  header{margin-bottom:12px}
  h1{margin:0;font-size:clamp(18px,2.6vw,28px)}
  .sub{color:var(--sub);margin:6px 0 0}
  main{display:grid;grid-template-columns:1.1fr .9fr;gap:20px}
  @media (max-width:1024px){main{grid-template-columns:1fr}}
  .card{background:var(--card);border-radius:var(--radius);box-shadow:var(--shadow);padding:18px}
  .stage{display:grid;grid-template-rows:auto 1fr auto;gap:16px;min-height:520px}
  .machine{position:relative;height:min(58vh,580px);display:grid;place-items:center;overflow:hidden;touch-action:none}
  .drum{width:min(520px,92%);aspect-ratio:1/1}
  .hex{transform-origin:100px 100px}
  .crank{transform-origin:100px 100px}
  /* æŠ½çå‹•ç•«ï¼šè½‰ç›¤ï¼‹æŠŠæ‰‹ä¸€èµ·è½‰ */
  .spin .hex,.spin .crank{animation:roll 1.4s cubic-bezier(.2,.7,.2,1) forwards}
  @keyframes roll{0%{transform:rotate(0)}100%{transform:rotate(720deg)}}

  .ball-slot{position:absolute;bottom:34px;left:50%;transform:translateX(-50%);display:flex;align-items:center;gap:12px}
  .ball{width:72px;height:72px;border-radius:50%;border:3px solid #1112;background:#e5e7eb;
        box-shadow:inset 0 8px 12px rgba(255,255,255,.7), inset 0 -10px 14px rgba(0,0,0,.15), 0 10px 16px rgba(0,0,0,.08);
        display:grid;place-items:center;font-weight:800;color:#111c;transform:translateY(90px);opacity:0}
  .ball.show{animation:pop .5s ease-out forwards}
  @keyframes pop{0%{transform:translateY(90px) scale(.9);opacity:0}60%{transform:translateY(-6px) scale(1.04);opacity:1}100%{transform:translateY(0) scale(1);opacity:1}}
  .label{font-size:22px;font-weight:800;letter-spacing:.08em;padding:10px 16px;border-radius:14px;background:#111;color:#fff;
         box-shadow:0 8px 18px rgba(0,0,0,.18);min-width:112px;text-align:center}

  .controls{display:flex;flex-wrap:wrap;gap:12px;align-items:center;justify-content:center}
  button{appearance:none;border:0;cursor:pointer;padding:16px 22px;border-radius:16px;font-weight:800;background:#111;color:#fff;min-height:56px;font-size:18px}
  button:active{transform:translateY(1px)}
  .btn-ghost{background:#e5e7eb;color:#111}
  .btn-success{background:#16a34a}

  .odds{display:grid;grid-template-columns:repeat(4,1fr);gap:12px;margin-top:10px}
  .odds .row{display:flex;align-items:center;gap:10px;background:#f3f4f6;border-radius:14px;padding:12px 14px;font-size:18px}
  .chip{width:22px;height:22px;border-radius:50%;border:2px solid #1113;box-shadow:inset 0 3px 5px rgba(255,255,255,.7), inset 0 -3px 5px rgba(0,0,0,.2);flex:0 0 22px}
  .chip.white{background:#fafafa}.chip.blue{background:#3b82f6}.chip.red{background:#ef4444}.chip.yellow{background:#fbbf24}
  input[type="number"]{width:100%;padding:12px;border:1px solid #e5e7eb;border-radius:12px;background:#fff;font-size:18px}

  .stats{display:grid;gap:12px}
  .statgrid{display:grid;grid-template-columns:repeat(4,1fr);gap:12px}
  .pill{display:grid;gap:8px;justify-items:center;padding:14px;border-radius:16px;background:#f3f4f6}
  .pill .count{font-size:28px;font-weight:900}
  .history{margin-top:8px;max-height:42vh;overflow:auto;border:1px dashed #e5e7eb;border-radius:14px;padding:12px;background:#fff}
  .history .item{display:flex;align-items:center;gap:12px;padding:12px 6px;border-bottom:1px solid #f3f4f6}
  .history .item:last-child{border-bottom:0}
  .time{color:#9ca3af;font-size:13px;margin-left:auto}
  #confetti{position:fixed;inset:0;pointer-events:none}
  #crankHit{cursor:grab;touch-action:none}
  .grabbing #crankHit{cursor:grabbing}
</style>
</head>
<body>
<canvas id="confetti"></canvas>
<div class="wrap">
  <header>
    <h1>ã‚¬ãƒ©ã‚¬ãƒ©ç¦å¼•ãï½œiPad ä¸­å¿ƒæŠŠæ‰‹ å…¨åŠŸèƒ½ç‰ˆ</h1>
    <p class="sub">æŠ“ä½**ä¸­å¿ƒæŠŠæ‰‹**å¾€åŒæ–¹å‘è½‰ï¼Œç´¯ç©ç´„ <b>360Â°</b> æœƒè‡ªå‹•æŠ½çã€‚ä¹Ÿå¯é»ç•«é¢æŠ½ã€‚</p>
  </header>

  <main>
    <section class="card stage">
      <div class="machine" id="machine" title="æŠ“ä½æŠŠæ‰‹æ—‹è½‰è©¦è©¦çœ‹">
        <svg class="drum" id="drumSvg" viewBox="0 0 200 200" role="img" aria-label="ç¦å¼•ãæ©Ÿ">
          <defs>
            <linearGradient id="g1" x1="0" x2="0" y1="0" y2="1">
              <stop offset="0" stop-color="#f59e0b"/><stop offset="1" stop-color="#b45309"/>
            </linearGradient>
            <linearGradient id="wood" x1="0" x2="0" y1="0" y2="1">
              <stop offset="0" stop-color="#d6b28a"/><stop offset="1" stop-color="#a8825a"/>
            </linearGradient>
          </defs>
          <!-- åº•åº§ -->
          <rect x="20" y="160" width="160" height="18" rx="6" fill="url(#wood)"/>
          <rect x="50" y="150" width="100" height="10" rx="4" fill="url(#wood)"/>
          <!-- è½‰ç›¤ -->
          <g class="hex" id="hex">
            <polygon points="100,35 145,55 165,100 145,145 100,165 55,145 35,100 55,55" fill="url(#g1)" stroke="#8b5a11" stroke-width="2"/>
            <polygon points="100,60 130,73 140,100 130,127 100,140 70,127 60,100 70,73" fill="#fde68a" opacity=".9" stroke="#b45309" stroke-width="1.5"/>
            <circle cx="100" cy="100" r="7" fill="#1f2937"/>
          </g>
          <!-- æŠŠæ‰‹ï¼ˆä¸­å¿ƒè»¸ï¼Œæ—‹è½‰åŸé»åœ¨ 100,100ï¼‰ -->
          <g class="crank" id="crank">
            <circle cx="100" cy="100" r="9" fill="#444"/>
            <line x1="100" y1="100" x2="100" y2="65" stroke="#222" stroke-width="6" stroke-linecap="round"/>
            <circle id="knob" cx="100" cy="65" r="9" fill="#111"/>
            <!-- æŠŠæ‰‹å¯é»æ“Šçš„è¼ƒå¤§ç¯„åœ -->
            <circle id="crankHit" cx="100" cy="65" r="20" fill="transparent"/>
          </g>
          <!-- å‡ºçƒå£ -->
          <rect x="92" y="138" width="16" height="22" rx="3" fill="#111"/>
          <rect x="84" y="156" width="32" height="8" rx="3" fill="#111"/>
        </svg>

        <div class="ball-slot" aria-live="polite">
          <div class="ball" id="ball"><span id="ballText">ï¼Ÿ</span></div>
          <div class="label" id="label">æŠ“ä½æŠŠæ‰‹è½‰å‹•</div>
        </div>
      </div>

      <div class="controls">
        <button id="rollBtn">ğŸ² é»ä¸€ä¸‹æŠ½</button>
        <button class="btn-ghost" id="copyBtn">è¤‡è£½çµæœ</button>
        <button class="btn-success" id="resetBtn">é‡ç½®</button>
      </div>

      <div class="odds" aria-label="ä¸­çæ©Ÿç‡è¨­å®š">
        <div class="row"><span class="chip white"></span><label>ç™½ <input type="number" min="0" step="1" value="60" id="odds-white"></label></div>
        <div class="row"><span class="chip blue"></span><label>è— <input type="number" min="0" step="1" value="20" id="odds-blue"></label></div>
        <div class="row"><span class="chip red"></span><label>ç´… <input type="number" min="0" step="1" value="15" id="odds-red"></label></div>
        <div class="row"><span class="chip yellow"></span><label>é»ƒ <input type="number" min="0" step="1" value="5" id="odds-yellow"></label></div>
        <div class="sub" style="grid-column:1/-1;text-align:center">æ•¸å­—ç‚ºã€Œæ¬Šé‡ã€ï¼Œç¸½å’Œä¸å¿…=100ï¼›è½‰æ»¿ä¸€åœˆï¼ˆç´„360Â°ï¼‰è‡ªå‹•æŠ½ç</div>
      </div>
    </section>

    <aside class="card">
      <div class="stats">
        <div class="statgrid">
          <div class="pill"><div class="chip white"></div><div>ç™½</div><div class="count" id="c-white">0</div></div>
          <div class="pill"><div class="chip blue"></div><div>è—</div><div class="count" id="c-blue">0</div></div>
          <div class="pill"><div class="chip red"></div><div>ç´…</div><div class="count" id="c-red">0</div></div>
          <div class="pill"><div class="chip yellow"></div><div>é»ƒ</div><div class="count" id="c-yellow">0</div></div>
        </div>
        <div class="history" id="history"></div>
      </div>
    </aside>
  </main>
</div>

<script>
(function(){
  // --- DOM ---
  const machine = document.getElementById('machine');
  const hex = document.getElementById('hex');
  const crank = document.getElementById('crank');
  const crankHit = document.getElementById('crankHit');
  const rollBtn = document.getElementById('rollBtn');
  const copyBtn = document.getElementById('copyBtn');
  const resetBtn = document.getElementById('resetBtn');
  const ballEl = document.getElementById('ball');
  const ballText = document.getElementById('ballText');
  const labelEl = document.getElementById('label');
  const histEl = document.getElementById('history');

  const counters = {
    white: document.getElementById('c-white'),
    blue:  document.getElementById('c-blue'),
    red:   document.getElementById('c-red'),
    yellow:document.getElementById('c-yellow')
  };
  const oddsInputs = {
    white: document.getElementById('odds-white'),
    blue:  document.getElementById('odds-blue'),
    red:   document.getElementById('odds-red'),
    yellow:document.getElementById('odds-yellow')
  };

  // --- å¸¸æ•¸ ---
  const COLORS = {
    white:{ zh:'ç™½', ja:'ç™½', css:'#fafafa', text:'#111', conf:'#e5e7eb' },
    blue: { zh:'è—', ja:'é’', css:'#3b82f6', text:'#fff', conf:'#93c5fd' },
    red:  { zh:'ç´…', ja:'èµ¤', css:'#ef4444', text:'#fff', conf:'#fca5a5' },
    yellow:{ zh:'é»ƒ', ja:'é»„', css:'#fbbf24', text:'#111', conf:'#fde68a' }
  };
  const TRIGGER_DEG = 360;

  // --- ç‹€æ…‹ ---
  let counts = {white:0, blue:0, red:0, yellow:0};
  let spinning = false;
  let lastResult = null;
  let dragging=false, lastAngle=0, accumDeg=0;

  // --- å·¥å…· ---
  function getSvgCenter(svgEl){
    const r = svgEl.getBoundingClientRect();
    return { x: r.left + r.width/2, y: r.top + r.height/2 };
  }
  function angleFromCenter(center, x, y){ return Math.atan2(y-center.y, x-center.x); }
  function rad2deg(r){ return r*180/Math.PI; }
  function normDeg(d){ while(d>180)d-=360; while(d<-180)d+=360; return d; }
  function now(){ const d=new Date(); const p=n=>String(n).padStart(2,'0'); return `${p(d.getHours())}:${p(d.getMinutes())}:${p(d.getSeconds())}`; }

  // --- æ©Ÿç‡ ---
  function readWeights(){
    const w = {
      white: Math.max(0, parseInt(oddsInputs.white.value||'0',10)),
      blue:  Math.max(0, parseInt(oddsInputs.blue.value ||'0',10)),
      red:   Math.max(0, parseInt(oddsInputs.red.value  ||'0',10)),
      yellow:Math.max(0, parseInt(oddsInputs.yellow.value||'0',10)),
    };
    if(w.white + w.blue + w.red + w.yellow <= 0){ w.white=60; w.blue=20; w.red=15; w.yellow=5; }
    return w;
  }
  function weightedPick(){
    const w = readWeights();
    let t = w.white + w.blue + w.red + w.yellow;
    let r = Math.random() * t;
    if((r -= w.white) < 0) return 'white';
    if((r -= w.blue ) < 0) return 'blue';
    if((r -= w.red  ) < 0) return 'red';
    return 'yellow';
  }

  // --- é¡¯ç¤º&çµ±è¨ˆ ---
  function setBall(colorKey){
    const c = COLORS[colorKey];
    ballEl.style.background=c.css; ballEl.style.color=c.text;
    ballText.textContent=c.zh;
    ballEl.classList.remove('show'); requestAnimationFrame(()=>ballEl.classList.add('show'));
    labelEl.textContent=`ä¸­çï¼š${c.zh}ï¼ˆ${c.ja}ï¼‰`;
  }
  function addHistory(colorKey){
    const c = COLORS[colorKey];
    const row = document.createElement('div'); row.className='item';
    const dot = document.createElement('span'); dot.className='chip'; dot.style.background=c.css; dot.style.borderColor='#0002';
    const name = document.createElement('b'); name.textContent=c.zh;
    const time = document.createElement('span'); time.className='time'; time.textContent=now();
    row.append(dot,name,time); histEl.prepend(row);
  }
  function updateCounts(){
    counters.white.textContent = counts.white;
    counters.blue.textContent  = counts.blue;
    counters.red.textContent   = counts.red;
    counters.yellow.textContent= counts.yellow;
  }

  // --- å½©å¸¶ ---
  function confettiBurst(hexColor){
    const canvas = document.getElementById('confetti');
    const ctx = canvas.getContext('2d');
    const dpr = Math.max(1, window.devicePixelRatio||1);
    function resize(){
      canvas.width = innerWidth * dpr;
      canvas.height = innerHeight * dpr;
      canvas.style.width = innerWidth + 'px';
      canvas.style.height = innerHeight + 'px';
    }
    resize();
    const parts=[], N=120, colors=[hexColor,'#ffffff','#111111','#e5e7eb'];
    for(let i=0;i<N;i++){
      parts.push({x:canvas.width/2,y:canvas.height/2,vx:(Math.random()-0.5)*9*dpr,vy:(Math.random()-1.2)*7*dpr,
                  g:0.18*dpr,s:(6+Math.random()*8)*dpr,r:Math.random()*Math.PI*2,vr:(Math.random()-.5)*0.2,
                  color:colors[Math.floor(Math.random()*colors.length)],life:80});
    }
    let id;
    (function loop(){
      id=requestAnimationFrame(loop);
      ctx.clearRect(0,0,canvas.width,canvas.height);
      parts.forEach(p=>{p.x+=p.vx;p.y+=p.vy;p.vy+=p.g;p.r+=p.vr;p.life--;
        ctx.save();ctx.translate(p.x,p.y);ctx.rotate(p.r);ctx.fillStyle=p.color;ctx.fillRect(-p.s/2,-p.s/2,p.s,p.s);ctx.restore();});
      if(parts.every(p=>p.life<=0)){cancelAnimationFrame(id);ctx.clearRect(0,0,canvas.width,canvas.height);}
    })();
  }

  // --- æŠ½ç ---
  function spinAndDraw(){
    if(spinning) return;
    spinning = true;
    labelEl.textContent='æŠ½é¸ä¸­â€¦';
    machine.classList.add('spin'); // hex + crank ä¸€èµ·è½‰
    setTimeout(()=>{
      machine.classList.remove('spin');
      const color = weightedPick();
      lastResult = color;
      counts[color]++; updateCounts();
      addHistory(color);
      setBall(color);
      confettiBurst(COLORS[color].conf);
      spinning = false;
    }, 1400);
  }

  // --- æŠŠæ‰‹æ‹–æ›³ï¼ˆä¸­å¿ƒæ—‹è½‰ï¼Œæ‹–æ›³ä¸­åŒæ­¥ï¼‰ ---
  function startDrag(x,y){
    if(spinning) return;
    dragging = true; accumDeg=0;
    const center = getSvgCenter(document.getElementById('drumSvg'));
    crank.dataset.cx = center.x; crank.dataset.cy = center.y;
    lastAngle = angleFromCenter(center, x, y);
    document.body.classList.add('lock');
    crank.classList.add('grabbing');
  }
  function moveDrag(x,y, prevent){
    if(!dragging) return;
    const cx = parseFloat(crank.dataset.cx), cy = parseFloat(crank.dataset.cy);
    const ang = angleFromCenter({x:cx,y:cy}, x, y);
    let delta = rad2deg(ang - lastAngle); delta = normDeg(delta);
    lastAngle = ang; accumDeg += delta;

    const rot = accumDeg % 360;
    hex.style.transform = `rotate(${rot}deg)`;
    crank.style.transform = `rotate(${rot}deg)`;
    labelEl.textContent = `è½‰å‹•ä¸­â€¦ ${Math.floor(Math.abs(accumDeg))}Â°`;
    if(prevent) prevent();

    if(Math.abs(accumDeg) >= TRIGGER_DEG){
      endDrag();
      setTimeout(spinAndDraw, 120);
    }
  }
  function endDrag(){
    if(!dragging) return;
    dragging=false;
    document.body.classList.remove('lock');
    crank.classList.remove('grabbing');
    // æ­¸é›¶æš«å­˜æ—‹è½‰ï¼ˆç”±å‹•ç•«æ¥æ‰‹ï¼‰
    hex.style.transform = `rotate(0deg)`;
    crank.style.transform = `rotate(0deg)`;
    if(Math.abs(accumDeg) < TRIGGER_DEG){
      labelEl.textContent = 'å†å¤šè½‰ä¸€é»ï¼';
      setTimeout(()=>{ if(!spinning) labelEl.textContent='æŠ“ä½æŠŠæ‰‹è½‰å‹•'; }, 900);
    }
  }

  // --- äº‹ä»¶ï¼ˆé˜²æ»‘å‹•ï¼‰ ---
  if(window.PointerEvent){
    crankHit.addEventListener('pointerdown', e=>{ e.preventDefault(); startDrag(e.clientX, e.clientY); crankHit.setPointerCapture?.(e.pointerId); }, {passive:false});
    window.addEventListener('pointermove', e=>{ if(!dragging) return; e.preventDefault(); moveDrag(e.clientX, e.clientY, ()=>e.preventDefault()); }, {passive:false});
    window.addEventListener('pointerup', e=>{ if(dragging){ e.preventDefault(); endDrag(); } }, {passive:false});
    window.addEventListener('pointercancel', e=>{ if(dragging){ e.preventDefault(); endDrag(); } }, {passive:false});
  }else{
    // iOS èˆŠç‰ˆ fallback
    crankHit.addEventListener('touchstart', e=>{ e.preventDefault(); const t=e.touches[0]; startDrag(t.clientX,t.clientY); }, {passive:false});
    window.addEventListener('touchmove', e=>{ if(!dragging) return; e.preventDefault(); const t=e.touches[0]; moveDrag(t.clientX,t.clientY, ()=>e.preventDefault()); }, {passive:false});
    window.addEventListener('touchend', e=>{ if(dragging){ e.preventDefault(); endDrag(); } }, {passive:false});
    crankHit.addEventListener('mousedown', e=>{ e.preventDefault(); startDrag(e.clientX,e.clientY); });
    window.addEventListener('mousemove', e=>{ if(!dragging) return; e.preventDefault(); moveDrag(e.clientX,e.clientY, ()=>e.preventDefault()); });
    window.addEventListener('mouseup', e=>{ if(dragging){ e.preventDefault(); endDrag(); } });
  }
  // é˜»æ“‹é›™æŒ‡ç¸®æ”¾
  window.addEventListener('gesturestart', e=>e.preventDefault(), {passive:false});

  // --- å‚™ç”¨æ“ä½œ & å…¬ç”¨ ---
  rollBtn.addEventListener('click', ()=>{ if(!spinning) spinAndDraw(); });
  machine.addEventListener('click', (e)=>{ if(e.target.id==='crankHit' || e.target.id==='knob') return; if(!spinning) spinAndDraw(); });

  copyBtn.addEventListener('click', ()=>{
    const w = readWeights();
    const text = lastResult
      ? `ç¦å¼•çµæœï¼š${COLORS[lastResult].zh}ï¼ˆ${COLORS[lastResult].ja}ï¼‰ï½œæ©Ÿç‡æ¬Šé‡ ç™½/è—/ç´…/é»ƒï¼š${w.white}/${w.blue}/${w.red}/${w.yellow}`
      : `å°šæœªæŠ½é¸ã€‚æ©Ÿç‡æ¬Šé‡ ç™½/è—/ç´…/é»ƒï¼š${w.white}/${w.blue}/${w.red}/${w.yellow}`;
    navigator.clipboard.writeText(text).then(()=>{ labelEl.textContent='å·²è¤‡è£½çµæœ'; setTimeout(()=>{ labelEl.textContent = lastResult?`ä¸­çï¼š${COLORS[lastResult].zh}ï¼ˆ${COLORS[lastResult].ja}ï¼‰`:'æŠ“ä½æŠŠæ‰‹è½‰å‹•'; }, 900); });
  });

  resetBtn.addEventListener('click', ()=>{
    counts={white:0,blue:0,red:0,yellow:0}; updateCounts();
    histEl.innerHTML=''; lastResult=null; ballText.textContent='ï¼Ÿ'; ballEl.classList.remove('show');
    ballEl.style.background='#e5e7eb'; ballEl.style.color='#111c'; labelEl.textContent='å·²é‡ç½®';
    setTimeout(()=>labelEl.textContent='æŠ“ä½æŠŠæ‰‹è½‰å‹•', 900);
  });

  Object.values(oddsInputs).forEach(inp=>{
    inp.addEventListener('input', ()=>{ if(inp.value==='') return; const v=Math.max(0, Math.round(Number(inp.value)||0)); inp.value=String(v); });
  });

  // åˆå§‹çµ±è¨ˆ
  updateCounts();
})();
</script>
</body>
</html>
